



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>EKS cluster setup using terraform - Codacy Chart</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.1b62728e.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#eks-cluster-setup-using-terraform" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Codacy Chart" class="md-header-nav__button md-logo">
          
            <img src="../../images/codacy-logo.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Codacy Chart
            </span>
            <span class="md-header-nav__topic">
              
                EKS cluster setup using terraform
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Codacy Chart" class="md-nav__button md-logo">
      
        <img src="../../images/codacy-logo.svg" width="48" height="48">
      
    </a>
    Codacy Chart
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Codacy Chart" class="md-nav__link">
      Codacy Chart
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Configuration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Configuration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/external-dbs/" title="Use external databases" class="md-nav__link">
      Use external databases
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/logging/" title="Logging" class="md-nav__link">
      Logging
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/monitoring/" title="Monitoring" class="md-nav__link">
      Monitoring
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-5" type="checkbox" id="nav-2-5">
    
    <label class="md-nav__link" for="nav-2-5">
      Providers
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-5">
        Providers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/providers/" title="Providers" class="md-nav__link">
      Providers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/providers/bitbucket-enterprise/" title="Bitbucket Stash" class="md-nav__link">
      Bitbucket Stash
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/providers/github-cloud/" title="GitHub Cloud" class="md-nav__link">
      GitHub Cloud
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/providers/github-enterprise/" title="GitHub Enterprise" class="md-nav__link">
      GitHub Enterprise
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../configuration/providers/gitlab-enterprise/" title="GitLab Enterprise" class="md-nav__link">
      GitLab Enterprise
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Installation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Installation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../installation/" title="Install" class="md-nav__link">
      Install
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../installation/uninstall/" title="Uninstall" class="md-nav__link">
      Uninstall
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../installation/upgrade/" title="Upgrade" class="md-nav__link">
      Upgrade
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Migration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Migration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../migration/database/" title="Database Migration Guide" class="md-nav__link">
      Database Migration Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Quickstart
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Quickstart
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../aks_quickstart/" title="AKS cluster quickstart" class="md-nav__link">
      AKS cluster quickstart
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        EKS cluster setup using terraform
      </label>
    
    <a href="./" title="EKS cluster setup using terraform" class="md-nav__link md-nav__link--active">
      EKS cluster setup using terraform
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    Requirements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tldr" class="md-nav__link">
    TL;DR
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#seting-up-an-eks-cluster-for-codacy" class="md-nav__link">
    Seting up an EKS cluster for Codacy
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment" class="md-nav__link">
    Deployment
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-backend-setup-terraform-state-storage" class="md-nav__link">
    1. backend - setup terraform state storage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-main-create-a-vanilla-eks-cluster" class="md-nav__link">
    2. main - create a vanilla EKS cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-setup-configure-your-eks-cluster-to-deploy-codacy" class="md-nav__link">
    3. setup - configure your EKS cluster to deploy codacy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-installing-codacy" class="md-nav__link">
    4. Installing Codacy
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#uninstalling" class="md-nav__link">
    Uninstalling
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-remove-the-cluster-setup-required-to-install-codacy" class="md-nav__link">
    1.  Remove the cluster setup required to install Codacy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-remove-the-cluster" class="md-nav__link">
    2.  Remove the cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-removing-the-terraform-backend" class="md-nav__link">
    3.  Removing the terraform backend
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Requirements
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Requirements
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../requirements/" title="Requirements" class="md-nav__link">
      Requirements
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    Requirements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tldr" class="md-nav__link">
    TL;DR
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#seting-up-an-eks-cluster-for-codacy" class="md-nav__link">
    Seting up an EKS cluster for Codacy
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment" class="md-nav__link">
    Deployment
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-backend-setup-terraform-state-storage" class="md-nav__link">
    1. backend - setup terraform state storage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-main-create-a-vanilla-eks-cluster" class="md-nav__link">
    2. main - create a vanilla EKS cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-setup-configure-your-eks-cluster-to-deploy-codacy" class="md-nav__link">
    3. setup - configure your EKS cluster to deploy codacy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-installing-codacy" class="md-nav__link">
    4. Installing Codacy
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#uninstalling" class="md-nav__link">
    Uninstalling
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-remove-the-cluster-setup-required-to-install-codacy" class="md-nav__link">
    1.  Remove the cluster setup required to install Codacy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-remove-the-cluster" class="md-nav__link">
    2.  Remove the cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-removing-the-terraform-backend" class="md-nav__link">
    3.  Removing the terraform backend
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="eks-cluster-setup-using-terraform">EKS cluster setup using terraform<a class="headerlink" href="#eks-cluster-setup-using-terraform" title="Permanent link">&para;</a></h1>
<p>This folder includes the terraform templates needed to create an EKS
cluster from scratch, including all the necessary underlying
infrastructure. It includes the following infrastructure stacks:</p>
<ul>
<li><strong>backend</strong> - (optional) the S3 bucket for storing the terraform state and the DynamoDB table for state locking.</li>
<li><strong>main</strong> - the EKS cluster, including all the network and nodes setup needed to go from zero to a fully functional EKS cluster.</li>
<li><strong>setup</strong> - additional setup you must perform before installing Codacy on your vanilla EKS cluster.</li>
</ul>
<h2 id="requirements">Requirements<a class="headerlink" href="#requirements" title="Permanent link">&para;</a></h2>
<p>In order to setup the infrastructure you'll need recent versions of:</p>
<ul>
<li><a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html">awscli</a></li>
<li><a href="https://learn.hashicorp.com/terraform/getting-started/install.html">terraform</a></li>
<li><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">kubectl</a></li>
<li><a href="https://helm.sh/docs/using_helm/#installing-helm">helm</a></li>
</ul>
<p>Please follow the documentation in the above links to setup these tools for your OS.
They can usually be easily installed using your package manager. For instance, on
macOS, if you are using <a href="https://brew.sh">Homebrew</a>, you can just run:</p>
<div class="codehilite"><pre><span></span>brew install awscli terraform kubernetes-helm kubectl
</pre></div>

<p>You'll also need to setup the CLI credentials for your AWS account. See how
to do it the <a href="https://docs.aws.amazon.com/polly/latest/dg/setup-aws-cli.html">AWS</a>
and <a href="https://www.terraform.io/docs/providers/aws/index.html">Terraform</a> documentation.
Note that, as stated in the documentation, if your <code class="codehilite"><span class="na">.aws</span><span class="err">/</span><span class="no">credentials</span></code> are fairly
complex you might need to set <code class="codehilite"><span class="err">AWS_SDK_LOAD_CONFIG=1</span></code> for Terraform to work correctly.</p>
<h2 id="tldr">TL;DR<a class="headerlink" href="#tldr" title="Permanent link">&para;</a></h2>
<h3 id="seting-up-an-eks-cluster-for-codacy">Seting up an EKS cluster for Codacy<a class="headerlink" href="#seting-up-an-eks-cluster-for-codacy" title="Permanent link">&para;</a></h3>
<p>Assuming AWS is well configured and you fulfill all the prerequisites,
the setup without state storage, can be done with:</p>
<div class="codehilite"><pre><span></span><span class="nb">export</span> <span class="nv">AWS_SDK_LOAD_CONFIG</span><span class="o">=</span><span class="m">1</span>
<span class="nb">cd</span> main/
terraform init <span class="o">&amp;&amp;</span> terraform apply
<span class="nb">cd</span> ../setup/
terraform init <span class="o">&amp;&amp;</span> terraform apply
aws eks update-kubeconfig --name codacy-cluster
</pre></div>

<h2 id="deployment">Deployment<a class="headerlink" href="#deployment" title="Permanent link">&para;</a></h2>
<h3 id="1-backend-setup-terraform-state-storage">1. <code class="codehilite"><span class="err">backend</span></code> - setup terraform state storage<a class="headerlink" href="#1-backend-setup-terraform-state-storage" title="Permanent link">&para;</a></h3>
<p>The <a href="https://www.terraform.io/docs/backends/index.html">backend</a> stores
the current and historical state of your infrastructure. Deploying and using
it is optional, but it might make your life easier if you are planning to use
these templates to make modifications to the cluster in the future.</p>
<p>To deploy it run:</p>
<div class="codehilite"><pre><span></span>terraform init <span class="o">&amp;&amp;</span> terraform apply
</pre></div>

<p>inside the <code class="codehilite"><span class="err">backend/</span></code> folder and follow terraform's instructions.</p>
<p>An S3 bucket with an unique name to save your state will be created. Note this
bucket's name and set it on the <code class="codehilite"><span class="err">config.tf</span></code> file of the <code class="codehilite"><span class="err">main/</span></code> and <code class="codehilite"><span class="err">setup/</span></code>
stacks where indicated.</p>
<h3 id="2-main-create-a-vanilla-eks-cluster">2. <code class="codehilite"><span class="err">main</span></code> - create a vanilla EKS cluster<a class="headerlink" href="#2-main-create-a-vanilla-eks-cluster" title="Permanent link">&para;</a></h3>
<p>To create a cluster, along with all the necessary network and nodes setup
it requires, run:</p>
<div class="codehilite"><pre><span></span>terraform init <span class="o">&amp;&amp;</span> terraform apply
</pre></div>

<p>inside the <code class="codehilite"><span class="err">main/</span></code> folder and follow terraform's instructions. This takes a while (~10min).</p>
<p>The cluster configuration (e.g., type/number of nodes, network CIDRs,...)
are exposed as variables in the <code class="codehilite"><span class="err">variables.tf</span></code> file. You may tailor the cluster
to your needs by editing the defaults that file, by using
<a href="https://www.terraform.io/docs/configuration/variables.html">CLI</a> options, viz.</p>
<div class="codehilite"><pre><span></span>terraform apply -var<span class="o">=</span><span class="s2">&quot;some_key=some_value&quot;</span>
</pre></div>

<p>or by writing them on a file named <code class="codehilite"><span class="err">terraform.tfvars</span></code> in the same folder
as the infrastructure code, which is loaded by default when you run apply.
For instance:</p>
<div class="codehilite"><pre><span></span><span class="nv">some_key</span> <span class="o">=</span> <span class="s2">&quot;a_string_value&quot;</span>
<span class="nv">another_key</span> <span class="o">=</span> <span class="m">3</span>
<span class="nv">someting_else</span> <span class="o">=</span> <span class="nb">true</span>
</pre></div>

<p>To connect to the cluster get its <code class="codehilite"><span class="err">kubeconfig</span></code> and set it the as default
context with:</p>
<div class="codehilite"><pre><span></span>aws eks update-kubeconfig --name codacy-cluster
</pre></div>

<p>If you now run</p>
<div class="codehilite"><pre><span></span>kubectl get pods -A
</pre></div>

<p>you'll see that nothing is scheduled. That's because you haven't yet allowed
the worker nodes to join the cluster
(see the <a href="https://docs.aws.amazon.com/eks/latest/userguide/add-user-role.html">EKS docs</a> for more info). We'll do that on step 3.</p>
<h3 id="3-setup-configure-your-eks-cluster-to-deploy-codacy">3. <code class="codehilite"><span class="err">setup</span></code> - configure your EKS cluster to deploy codacy<a class="headerlink" href="#3-setup-configure-your-eks-cluster-to-deploy-codacy" title="Permanent link">&para;</a></h3>
<p>Some additional setup  is necessary to run Codacy on the cluster you just created.
For one, you need to allow workers to join the cluster. Docker pull secrets need to be added to the <code class="codehilite"><span class="err">codacy</span></code> namespace, which will also be added here,
and the following helm charts will be installed:
<a href="https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/">kubernetes-dashboard</a>,
<a href="https://github.com/helm/charts/tree/master/stable/nginx-ingress">nginx-ingress</a>, and
<a href="https://github.com/jetstack/cert-manager">cert-manager</a>.</p>
<p>To do it run</p>
<div class="codehilite"><pre><span></span>terraform init <span class="o">&amp;&amp;</span> terraform apply
</pre></div>

<p>You'll be prompted to input Codacy's docker hub repo password.</p>
<p>If you'd like to connect to the kubernetes dashboard, get the admin token
by running</p>
<div class="codehilite"><pre><span></span>terraform output admin_token
</pre></div>

<p>and copy the outputed value. To connect to the dashboard run</p>
<div class="codehilite"><pre><span></span>kubectl proxy
</pre></div>

<p>and then connect to <a href="http://127.0.0.1:8001/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:https/proxy">the dashboard url</a>,
select <code class="codehilite"><span class="err">token</span></code> and paste the value you saved above.</p>
<h3 id="4-installing-codacy">4. Installing Codacy<a class="headerlink" href="#4-installing-codacy" title="Permanent link">&para;</a></h3>
<p>To install Codacy please see the <a href="../../installation/">installation documentation</a>.</p>
<h2 id="uninstalling">Uninstalling<a class="headerlink" href="#uninstalling" title="Permanent link">&para;</a></h2>
<p><strong>WARNING: IF YOU PROCEED BEYOND THIS POINT YOU'LL PERMANENTLY DELETE AND BREAK THINGS</strong></p>
<h3 id="1-remove-the-cluster-setup-required-to-install-codacy">1.  Remove the cluster setup required to install Codacy<a class="headerlink" href="#1-remove-the-cluster-setup-required-to-install-codacy" title="Permanent link">&para;</a></h3>
<p>To cleanup your cluster back to a <em>vanilla</em> state you can now run,
the following command in the <code class="codehilite"><span class="err">setup/</span></code> folder:</p>
<div class="codehilite"><pre><span></span>terraform destroy
</pre></div>

<h3 id="2-remove-the-cluster">2.  Remove the cluster<a class="headerlink" href="#2-remove-the-cluster" title="Permanent link">&para;</a></h3>
<p>After removing all the above stacks and setup, you may now delete the kubernetes
cluster by running in the <code class="codehilite"><span class="err">main/</span></code> directory:</p>
<div class="codehilite"><pre><span></span>terraform destroy
</pre></div>

<p>This takes a while (~10min).</p>
<h3 id="3-removing-the-terraform-backend">3.  Removing the terraform backend<a class="headerlink" href="#3-removing-the-terraform-backend" title="Permanent link">&para;</a></h3>
<p>If you created the terraform backend with the above stack you can now safely
delete it. The backend is purposely created with extra settings to prevent
its accidental destruction. To destroy it cleanly the easiest path is to disable
these extra settings. Go to the <code class="codehilite"><span class="err">backend/</span></code> folder and change the <code class="codehilite"><span class="err">state_and_lock.tf</span></code>
file as instructed therein.</p>
<p>Afterwards, you can now destroy it by running</p>
<div class="codehilite"><pre><span></span>terraform apply <span class="o">&amp;&amp;</span> terraform destroy
</pre></div>

<p>Note that you first have to apply to change the bucket settings, and only
then will destroy work.</p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../aks_quickstart/" title="AKS cluster quickstart" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                AKS cluster quickstart
              </span>
            </div>
          </a>
        
        
          <a href="../../requirements/" title="Requirements" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Requirements
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Codacy
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="../../javascripts/extra.js"></script>
      
    
  </body>
</html>